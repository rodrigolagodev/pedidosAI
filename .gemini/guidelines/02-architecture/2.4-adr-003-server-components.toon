metadata:
  id: arch-adr-003
  version: 1.0
  lastUpdated: 2025-11-18
  references[2]: arch-adr-001,proj-principles

content:
  title: "ADR-003: Server Components by Default"
  purpose: Document the decision to use Server Components as the default rendering strategy.

  sections[1]:
    - id: arch-adr-003-decision
      title: Decision Record
      status: Accepted
      date: 2025-11-18

      context: |
        React Server Components (RSC) allow rendering on the server without sending JavaScript to client.
        Need to decide default approach: Server Components or Client Components.

      decision: Use Server Components by default. Only add 'use client' when client-side interactivity is required.

      rationale[5]:
        - Smaller client bundle improves performance
        - Direct database access without API layer
        - Better SEO with server-rendered content
        - Simpler data fetching patterns
        - Aligns with Next.js App Router design

      consequences:
        positive[4]:
          - Faster initial page load
          - Less client-side JavaScript
          - Simplified data fetching code
          - Better Core Web Vitals
        negative[2]:
          - Cannot use hooks in Server Components
          - Must carefully plan component boundaries

      clientComponentTriggers[6]:
        - useState or useEffect hooks
        - Event handlers (onClick, onChange)
        - Browser APIs (localStorage, navigator)
        - Custom hooks with state
        - Third-party client libraries
        - Real-time subscriptions

      pattern:
        description: Server Component with client interactive parts
        code: |
          // app/orders/page.tsx - Server Component (default)
          import { createClient } from '@/lib/supabase/server'
          import { OrderList } from './OrderList'
          import { CreateOrderButton } from './CreateOrderButton'

          export default async function OrdersPage() {
            const supabase = await createClient()
            const { data: orders } = await supabase
              .from('orders')
              .select('*')

            return (
              <div>
                <h1>Mis Pedidos</h1>
                {/* Server Component - renders static list */}
                <OrderList orders={orders ?? []} />
                {/* Client Component - has onClick */}
                <CreateOrderButton />
              </div>
            )
          }

          // components/orders/CreateOrderButton.tsx
          'use client' // Only this component needs client

          export function CreateOrderButton() {
            const router = useRouter()
            return (
              <button onClick={() => router.push('/orders/new')}>
                Nuevo Pedido
              </button>
            )
          }
      antiPattern:
        description: Unnecessary 'use client' or wrong boundaries
        code: |
          // DON'T mark entire page as client
          'use client' // Unnecessary!

          export default function OrdersPage() {
            const [orders, setOrders] = useState([])

            useEffect(() => {
              fetch('/api/orders').then(...)
            }, [])

            return <OrderList orders={orders} />
          }

          // DON'T fetch data in client when server can do it
          // This adds unnecessary API layer and loading states